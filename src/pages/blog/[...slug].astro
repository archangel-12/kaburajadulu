---
import { getCollection, getEntry, render } from 'astro:content';
import BlogLayout from '../../layouts/BlogLayout.astro';
import { Badge } from '../../components/ui/badge';

export async function getStaticPaths() {
  const blogEntries = await getCollection('blog', ({ data }) => !data.draft);
  return blogEntries.map(entry => ({
    params: { slug: entry.id },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await render(entry);
---

<BlogLayout 
  title={entry.data.title}
  description={entry.data.description}
  author={entry.data.author}
  pubDate={entry.data.pubDate}
  category={entry.data.category}
  image={entry.data.image}
  canonical={new URL(`/blog/${entry.id}`, Astro.site).toString()}
>
  <!-- Main Content Container with proper styling -->
  <div class="blog-container">
    <!-- Featured Image -->
    {entry.data.image && (
      <div class="featured-image">
        <img 
          src={entry.data.image} 
          alt={entry.data.title}
          loading="eager"
        />
      </div>
    )}

    <!-- Category Badge with proper client directive -->
    <Badge variant="category" client:load>
      {entry.data.category}
    </Badge>

    <!-- Blog Content -->
    <div class="blog-content">
      <!-- Title -->
      <h1 class="blog-title">
        {entry.data.title}
      </h1>
      
      <!-- Author and Date -->
      <div class="blog-meta">
        <span>{entry.data.author}</span>
        <span>|</span>
        <time>
          {entry.data.pubDate.toLocaleDateString('id-ID', { 
            day: 'numeric',
            month: 'long',
            year: 'numeric' 
          })}
        </time>
      </div>

      <!-- Article Content -->
      <article class="prose-content">
        <Content />
      </article>
    </div>
  </div>

<style>
  /* Blog Layout - Based on Figma design specifications */
  .blog-container {
    max-width: 1040px;
    width: 100%;
    margin: 0 auto;
    padding-top: 170px;
    padding-left: 200px;
    padding-right: 200px;
    display: flex;
    flex-direction: column;
    gap: 24px;
  }

  .featured-image {
    width: 100%;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .featured-image img {
    width: 100%;
    height: auto;
    display: block;
  }

  .blog-content {
    display: flex;
    flex-direction: column;
    gap: 24px;
  }

  .blog-title {
    font-size: 32px;
    font-weight: 700;
    line-height: 1.25;
    color: #000000;
    margin: 0;
  }

  .blog-meta {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    color: #6B7280;
    font-weight: 400;
  }

  /* Article content styles */
  .prose-content {
    font-size: 16px;
    line-height: 1.7;
    color: #374151;
  }

  .prose-content :global(p) {
    margin-bottom: 24px;
    color: #374151;
    line-height: 1.7;
  }

  .prose-content :global(p:last-child) {
    margin-bottom: 0;
  }

  .prose-content :global(h1) {
    font-size: 24px;
    font-weight: 700;
    color: #111827;
    margin-top: 32px;
    margin-bottom: 16px;
    line-height: 1.3;
  }
  
  .prose-content :global(h2) {
    font-size: 20px;
    font-weight: 700;
    color: #111827;
    margin-top: 28px;
    margin-bottom: 12px;
    line-height: 1.3;
  }
  
  .prose-content :global(h3) {
    font-size: 18px;
    font-weight: 700;
    color: #111827;
    margin-top: 24px;
    margin-bottom: 8px;
    line-height: 1.3;
  }
  
  .prose-content :global(ul) {
    margin-bottom: 24px;
    padding-left: 24px;
  }
  
  .prose-content :global(li) {
    margin-bottom: 8px;
    color: #374151;
    line-height: 1.7;
  }
  
  .prose-content :global(strong) {
    font-weight: 600;
    color: #111827;
  }
  
  .prose-content :global(a) {
    color: #3B82F6;
    transition: color 0.15s ease-in-out;
  }
  
  .prose-content :global(a:hover) {
    color: #1D4ED8;
  }
  
  .prose-content :global(blockquote) {
    border-left: 4px solid #E5E7EB;
    padding-left: 16px;
    font-style: italic;
    color: #6B7280;
    margin: 24px 0;
  }

  /* Responsive design */
  @media (max-width: 1024px) {
    .blog-container {
      padding-left: 32px;
      padding-right: 32px;
      padding-top: 120px;
    }
  }

  @media (max-width: 768px) {
    .blog-container {
      padding-left: 16px;
      padding-right: 16px;
      padding-top: 80px;
      gap: 20px;
    }

    .blog-title {
      font-size: 24px;
      line-height: 1.3;
    }

    .blog-content {
      gap: 20px;
    }

    .prose-content {
      font-size: 15px;
    }
  }

  @media (max-width: 640px) {
    .blog-container {
      padding-top: 60px;
      gap: 16px;
    }

    .blog-title {
      font-size: 20px;
    }

    .blog-content {
      gap: 16px;
    }
  }
</style>